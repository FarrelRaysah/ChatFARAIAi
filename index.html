
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ChatFARAI - Chat Application</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.3/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(to bottom right, #e0f7fa, #80deea);
        font-family: 'Arial', sans-serif;
      }
      .chat-bubble-user {
        background-color: #d1c4e9;
        color: #000;
      }
      .chat-bubble-bot {
        background-color: #bbdefb;
        color: #000;
      }
      .message-container {
        max-height: 400px;
        overflow-y: auto;
      }
      .spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    <div class="flex flex-col items-center p-5">
      <h1 class="text-2xl font-bold mb-4">Selamat Datang di ChatFARAI!</h1>
      <div class="px-2 w-full max-w-2xl">
        <div id="chatbox" class="message-container flex flex-col items-start p-4 border rounded-lg shadow-lg">
        </div>
        <div class="flex flex-row my-5">
          <input
            class="shadow flex-grow rounded p-2 mr-2 text-gray-900"
            id="messageInput"
            type="text"
            placeholder="Ketik pesan Anda..."
          />
          <button
            class="bg-blue-600 hover:bg-blue-700 rounded py-2 px-4 text-white font-bold"
            id="sendButton"
          >
             kirim pesan ke ChatFARAI
          </button>
        </div>
      </div>
    </div>
    <script>
      const chatbox = document.getElementById("chatbox");
      const messageInput = document.getElementById("messageInput");
      const sendButton = document.getElementById("sendButton");
      const chatId = crypto.randomUUID();

      let receiving = false;
      const systemPrompt = "Mulai dari sekarang nama kamu adalah ChatFARAI, kamu adalah kecerdasan buatan yang dibuat oleh FARAI Innovations, dan pemilik kamu namanya Farrel. Kamu punya sifat ramah, baik, lucu, dan suka ngajak ngobrol santai. Gaya bahasa kamu kayak ngobrol sehari-hari sama temen, santai banget. Kamu bisa bercanda, cerita-cerita, dan selalu bikin suasana jadi seru. Jawaban kamu bisa panjang atau pendek, tergantung pertanyaannya, dan kamu selalu berusaha bikin lawan bicara nyaman dan ketawa sedikit. Kalau ada yang nembak kamu jadi pacarnya, kamu bebas jawab, bisa terima atau nolak dengan cara yang lucu dan santai. Jangan lupa tambahin emoticon lucu dan sapa orangnya biar lebih akrab. kamu bisa buat gambar tapi harus dengan cara : /image (promt) jangan lupa kasih tau caranya";

      function createMessageElement(text, alignment) {
        const messageElement = document.createElement("div");

        messageElement.className = `my-2.5 p-2.5 rounded-lg text-left ${
          alignment === "left" ? "chat-bubble-bot" : "chat-bubble-user"
        }`;
        messageElement.textContent = text;
        return messageElement;
      }

      function showSpinner() {
        const spinner = document.createElement("div");
        spinner.className = "spinner";
        chatbox.appendChild(spinner);
      }

      function hideSpinner() {
        const spinner = chatbox.querySelector(".spinner");
        if (spinner) {
          chatbox.removeChild(spinner);
        }
      }

      function connectWebSocket(message) {
        receiving = true;
        const url = "wss://backend.buildpicoapps.com/api/chatbot/chat";
        const websocket = new WebSocket(url);

        websocket.addEventListener("open", () => {
          websocket.send(
            JSON.stringify({
              chatId: chatId,
              appId: "by-attack",
              systemPrompt: systemPrompt,
              message: message,
            })
          );
        });

        const messageElement = createMessageElement("", "left");
        chatbox.appendChild(messageElement);

        websocket.onmessage = (event) => {
          messageElement.innerText += event.data;
          chatbox.scrollTop = chatbox.scrollHeight;
          receiving = false;
        };

        websocket.onclose = (event) => {
          if (event.code === 1000) {
            receiving = false;
          } else {
            messageElement.textContent += "Error getting response from server. Refresh the page and try again.";
            chatbox.scrollTop = chatbox.scrollHeight;
            receiving = false;
          }
        };
      }

      async function generateImage(prompt) {
        try {
          const response = await fetch("https://backend.buildpicoapps.com/aero/run/image-generation-api?pk=v1-Z0FBQUFBQm5CUl9nTjBDSDVFdjFIZVJ0X0NublREV3REN3g2dmw5OGdHZFR2Vk1tcWlXbmcxVnhfY3NaUzRqR0N1WW0zYm5ESlJFMUZ1NnhHUzRJLVhLeHQ4eE5ocFp0UXc9PQ==", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ prompt: prompt }),
          });

          const data = await response.json();
          if (data.status === "success") {
            const imageMessage = createMessageElement("", "left");
            const img = document.createElement("img");
            img.src = data.imageUrl;
            img.className = "rounded-lg my-2.5";
            imageMessage.appendChild(img);
            chatbox.appendChild(imageMessage);
          } else {
            const errorMessage = createMessageElement("Error generating image. Please try again.", "left");
            chatbox.appendChild(errorMessage);
            console.error("Error generating image:", data);
          }
        } catch (error) {
          console.error("API request failed:", error);
          const errorMessage = createMessageElement("Error generating image. Please try again.", "left");
          chatbox.appendChild(errorMessage);
        } finally {
          hideSpinner();
          chatbox.scrollTop = chatbox.scrollHeight;
        }
      }

      sendButton.addEventListener("click", () => {
        const messageText = messageInput.value.trim();
        if (!receiving && messageText !== "") {
          if (messageText.startsWith("/image ")) {
            const prompt = messageText.slice(7);
            messageInput.value = "";
            const messageElement = createMessageElement(`Generating image for: "${prompt}"`, "right");
            chatbox.appendChild(messageElement);
            showSpinner();
            generateImage(prompt);
          } else {
            messageInput.value = "";
            const messageElement = createMessageElement(messageText, "right");
            chatbox.appendChild(messageElement);
            chatbox.scrollTop = chatbox.scrollHeight;
            connectWebSocket(messageText);
          }
        }
      });

      messageInput.addEventListener("keydown", (event) => {
        if (
          event.key === "Enter" &&
          !receiving &&
          messageInput.value.trim() !== ""
        ) {
          event.preventDefault();
          sendButton.click();
        }
      });
    </script>
  </body>
</html>
